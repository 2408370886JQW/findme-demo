# FIND ME 团购交易技术方案评审

## Slide 1: 核心目标与范围
- **目标**: 构建从“发现”到“核销”的完整团购交易闭环，打造沉浸式消费体验。
- **范围**: 
  - 前端交互：列表诱导、详情沉浸、丝滑下单、仪式感核销。
  - 后端能力：结构化商品管理、高并发库存扣减、安全核销验证。
- **关键指标**: 提升下单转化率，确保交易数据零差错。

## Slide 2: 交互体验 - 视觉诱导与沉浸
- **列表页**: 
  - 视觉重心：主色调强调价格与折扣，销量背书增加信任。
  - 微交互：按压反馈与“抢购”按钮缩短决策路径。
- **详情页**:
  - 共享元素转场：图片平滑放大，背景高斯模糊，营造沉浸感。
  - 结构化菜单：时间轴展示上菜顺序，折叠过长内容，降低阅读负担。

## Slide 3: 交互体验 - 下单与核销
- **下单流程**:
  - 底部浮层 (Bottom Sheet)：不跳页直接下单，数字滚动动画增加实感。
  - 支付反馈：全屏彩带动画 (Confetti) 庆祝支付成功。
- **核销仪式**:
  - 屏幕高亮：自动调亮屏幕方便扫码。
  - 盖章动画：核销成功瞬间展示“已核销”印章，伴随触觉反馈。

## Slide 4: 数据模型 - 套餐 (Deal)
- **结构化设计**:
  - `menu`: 支持多级分类（前菜/主食），关联单品图片与价格。
  - `rules`: 结构化购买须知（有效期/退款政策），支持前端 Icon 化展示。
- **关键字段**:
  - `stock`: 库存管理（-1 为无限）。
  - `salesCount`: 销量展示。
  - `status`: 状态流转 (ACTIVE/SOLD_OUT/OFFLINE)。

## Slide 5: 数据模型 - 订单 (Order)
- **状态机**:
  - `PENDING_PAY`: 待支付（预扣库存）。
  - `PAID`: 已支付（生成核销码）。
  - `USED`: 已核销（终态）。
  - `REFUNDING/REFUNDED`: 退款流程。
- **核销凭证**:
  - `redemptionCode`: 12位唯一数字码，算法混淆生成。
  - `qrCodeUrl`: 动态生成的二维码链接。

## Slide 6: 核心接口 - 交易链路
- **下单 (POST /orders)**:
  - 预占库存（Redis Lua 原子操作）。
  - 返回支付参数 (SDK Params)。
- **支付回调 (Webhook)**:
  - 验签与金额校验。
  - 状态变更 (PENDING -> PAID)。
  - 生成核销码并推送 WebSocket 通知。

## Slide 7: 核心接口 - 核销验证
- **商家核销 (POST /merchant/redeem)**:
  - 校验券码有效性与状态。
  - 状态变更 (PAID -> USED)。
  - 记录核销日志（操作人/时间）。
- **双端通知**:
  - WebSocket 推送给用户端：触发“盖章”动画。
  - WebSocket 推送给商家端：显示核销成功详情。

## Slide 8: 系统时序 - 购买流程
- **关键节点**:
  1. 用户下单 -> Redis 预扣库存。
  2. 支付成功 -> 异步回调 -> 生成核销码。
  3. WebSocket 推送 -> 前端展示成功页。
- **异常处理**:
  - 库存不足直接返回。
  - 支付超时自动释放库存。

## Slide 9: 系统时序 - 核销流程
- **关键节点**:
  1. 用户出示 -> 商家扫码。
  2. 服务端校验 -> 更新状态。
  3. 双端推送 -> 完成闭环。
- **安全机制**:
  - 核销码全局唯一且不可预测。
  - 接口幂等性设计，防止重复核销。

## Slide 10: 总结与下一步
- **技术亮点**:
  - 极致的前端交互体验（动效/触感）。
  - 严谨的后端交易逻辑（状态机/原子扣减）。
- **下一步计划**:
  - 开发排期与联调计划。
  - 压力测试（秒杀场景）。
  - 埋点数据规划。
