# FIND ME 产品需求文档 (团购交易专项版)

**版本号**: v1.1 (团购专项)  
**状态**: 待开发  
**最后更新**: 2026-01-19  
**作者**: Manus AI

---

## 1. 概述 (Overview)

### 1.1 背景
本版本 PRD 剥离了社交分享属性，**核心聚焦于“团购交易闭环”**。旨在构建一套完整的从“发现套餐”到“购买核销”的业务逻辑，确保用户能够清晰地了解套餐内容、完成购买并顺利到店消费。

### 1.2 核心流程图
`浏览商家 -> 查看套餐详情 -> 下单支付 -> 生成核销码 -> 到店核销 -> 评价`

---

## 2. 核心功能模块 (Core Modules)

### 2.1 商家详情页 - 团购展示 (Shop Detail - Deal Display)
**逻辑描述**：
在商家详情页中，团购套餐是核心转化入口，需突出性价比和套餐内容的丰富度。

*   **套餐列表**：
    *   展示该商家下的所有可用套餐。
    *   **卡片信息**：套餐名称（如“浪漫双人烛光晚餐”）、现价（高亮）、原价（划线）、折扣标签（如“5.8折”）、销量（如“半年售300+”）。
    *   **购买按钮**：显眼的“抢购”或“¥520 购买”按钮。
*   **套餐详情页 (Deal Detail)**：
    *   点击列表项进入独立的套餐详情页。
    *   **套餐内容 (Menu)**：结构化展示菜品明细。
        *   *分组展示*：前菜、主食、甜点、饮品。
        *   *单品详情*：菜品名称、份数、单价。
    *   **购买须知 (Rules)**：
        *   *有效期*：购买后X天内有效 / 指定日期不可用。
        *   *使用时间*：如 17:00-22:00。
        *   *预约规则*：无需预约 / 需提前1天预约。
        *   *退款政策*：随时退 / 过期自动退 / 不可退。
    *   **底部浮层**：固定展示“价格”和“立即购买”按钮。

### 2.2 交易下单流程 (Transaction Flow)
**逻辑描述**：
模拟完整的电商下单体验，确保数据流转的准确性。

*   **订单确认页 (Order Confirmation)**：
    *   **商品信息**：套餐名称、单价。
    *   **数量选择**：步进器控制购买数量（默认1）。
    *   **小计金额**：单价 * 数量。
    *   **手机号**：默认填入当前用户手机号（用于接收短信通知）。
    *   **支付方式**：微信支付 / 支付宝（Demo阶段模拟支付成功）。
*   **支付结果页 (Payment Result)**：
    *   **成功状态**：显示“支付成功”，展示核销码（二维码 + 数字码）。
    *   **引导**：按钮“查看订单”或“返回商家”。

### 2.3 订单中心 (Order Management)
**逻辑描述**：
用户管理已购套餐的入口，核心是查看券码和订单状态。

*   **订单列表**：
    *   **状态筛选**：全部 / 待使用 / 已使用 / 退款/售后。
    *   **卡片展示**：商家图、套餐名、总价、**状态标签**。
*   **订单详情 (Order Detail)**：
    *   **核销凭证**：
        *   **二维码**：高亮展示，支持点击放大（方便扫码）。
        *   **券码**：12位数字码（如 `2839 1029 3847`），支持复制。
        *   **状态**：待使用（绿色）、已核销（灰色）、已退款（红色）。
    *   **订单信息**：订单号、下单时间、支付方式、实付金额。
    *   **操作按钮**：
        *   *待使用*：申请退款。
        *   *已使用*：去评价。
        *   *已退款*：查看进度。

### 2.4 核销逻辑 (Redemption Logic)
**逻辑描述**：
定义券码的生命周期和验证方式。

*   **券码生成规则**：
    *   格式：12位纯数字，每4位空格分隔。
    *   唯一性：全局唯一，与 OrderID 绑定。
*   **状态流转**：
    1.  `PENDING` (待使用)：支付成功后初始状态。
    2.  `USED` (已核销)：商家扫码或输入数字码验证通过后。
    3.  `REFUNDING` (退款中)：用户发起退款申请。
    4.  `REFUNDED` (已退款)：退款审批通过。
    5.  `EXPIRED` (已过期)：超过有效期未核销（触发自动退款逻辑）。

---

## 3. 数据结构 (Data Structures)

### 3.1 套餐 (Deal) - 扩展
```typescript
interface Deal {
  id: string;
  shopId: string;
  title: string;          // 套餐标题
  price: number;          // 现价
  originalPrice: number;  // 原价
  salesCount: number;     // 销量
  images: string[];       // 套餐图片
  
  // 套餐内容结构化
  menu: {
    category: string;     // e.g., "前菜"
    items: {
      name: string;       // e.g., "法式鹅肝"
      count: number;      // e.g., 1
      price: number;      // 单价
    }[];
  }[];

  // 购买须知
  rules: {
    validity: string;     // 有效期描述
    usageTime: string;    // 使用时间
    appointment: string;  // 预约规则
    refund: string;       // 退款规则
  };
}
```

### 3.2 订单 (Order)
```typescript
interface Order {
  id: string;             // 订单号
  userId: string;
  shopId: string;
  dealId: string;
  
  status: 'PENDING' | 'USED' | 'REFUNDING' | 'REFUNDED' | 'EXPIRED';
  
  quantity: number;       // 购买数量
  totalAmount: number;    // 总金额
  paymentTime: string;    // 支付时间
  
  // 核销凭证
  redemptionCode: string; // 12位核销码
  qrCodeUrl: string;      // 二维码图片链接
}
```

---

## 4. 交互细节 (Interaction Details)

### 4.1 购买须知折叠
*   在套餐详情页，如果“购买须知”内容过长，默认展示前 3 条，点击“查看更多”展开全部。

### 4.2 屏幕亮度自动调节
*   进入“订单详情”页查看核销码时，App 应自动将屏幕亮度调至最高（方便扫码枪识别），退出页面后恢复原亮度。

### 4.3 防误触退款
*   点击“申请退款”时，需弹出二次确认弹窗，提示“退款后优惠券将失效，确定要退款吗？”。
